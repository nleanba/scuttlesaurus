<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <title>Tricerascuttler</title>
</head>

<body>
    <ssb-header></ssb-header>
    <p id="instance">

    </p>
    <script type="module">
        import { runQuery, mainIdentity } from "./js/web-util.js";

        async function tripleCount() {
            const result = await runQuery(`SELECT (COUNT(*) as ?count) WHERE { ?s ?p ?o}`)
            return parseInt(result.results.bindings[0].count.value)
        }

        async function messagesCount() {
            const result = await runQuery(`PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX ssb: <ssb:ontology:>

                SELECT (COUNT(DISTINCT ?s) as ?count) WHERE { ?s rdf:type ssb:Message}`)
            return parseInt(result.results.bindings[0].count.value)
        }
        const tripleCountP = tripleCount();
        const messagesCountP = messagesCount();
        const mainIdentityP = mainIdentity();
        document.getElementById("instance").innerHTML = `
        <h1>This instance</h1>
        <ul>
        <li>Messages: ${(await messagesCountP).toLocaleString()}</li>
        <li>Triples: ${(await tripleCountP).toLocaleString()}</li>
        <li>Identity: <ssb-feed-author src="${await mainIdentityP}"></ssb-feed-author></li>
        </ul>
        `;
    </script>
    <h1>Powered by Tricerascuttler</h1>
    <p>
        Triceracuttler uses Scuttlesaurus to aggregate Scuttlebutt
        data in an RDF Store.
    </p>
    Developped by:
    <ssb-feed-author src="ssb:feed/ed25519/IX0YhhVNgs9btLPepGlyLpXKvB0URDHLrmrm4yDlD1c="></ssb-feed-author>
    <p>
        Sourcecode on <a href="https://github.com/retog/scuttlesaurus/tree/master/tricerascuttler">Github</a>.
    </p>

    <p>
        First mention of Tricerascuttler in the known Scuttleverse:
        <ssb-post src="ssb:message/sha256/ddZPPcrgpbAX6wgCxU7SmVzIm6iJhFxpy2-a7-qAk-M="></ssb-post>
    </p>
    <script type="module" src="js/FeedAuthorElement.js"></script>
    <script type="module" src="js/HeaderElement.js"></script>
    <script type="module" src="js/PostElement.js"></script>

</body>

</html>